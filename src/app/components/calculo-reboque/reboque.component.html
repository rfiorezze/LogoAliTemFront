<app-titulo [titulo]="'Calculadora de Reboque'" [subtitulo]="'Calcule o custo do reboque aqui'" [iconClass]="'fa fa-truck'" [botaoListar]="false"></app-titulo>
<div class="card shadow-sm p-4">
  <form [formGroup]="formCalculo">
    <fieldset [disabled]="solicitacaoEmAndamento">
      <!-- Tipo do veÃ­culo -->
      <div class="mb-3">
        <label class="form-label fw-bold">ğŸš˜ Tipo do VeÃ­culo</label>
        <select class="form-select" formControlName="tipoVeiculo">
          <option value="" disabled selected>Selecione...</option>
          <option value="Leve">Leve (Carros e Motos)</option>
          <option value="Utilitario">UtilitÃ¡rio (Picapes e furgÃµes mÃ©dios)</option>
          <option value="Semi-Pesado">Semi-Pesado (Vans)</option>
        </select>
      </div>

      <!-- EndereÃ§o de Retirada -->
      <div class="mb-3">
        <label class="form-label fw-bold">ğŸ“ EndereÃ§o de Retirada</label>
        <div class="input-group">
          <input type="text" id="localRetirada" class="form-control" formControlName="localRetirada" placeholder="Digite ou use geolocalizaÃ§Ã£o" />
          <button type="button" class="btn btn-primary px-3" (click)="usarGeolocalizacao()">ğŸ“</button>
        </div>
        <ul *ngIf="sugestoesRetirada.length > 0" class="list-group mt-2">
          <li *ngFor="let sugestao of sugestoesRetirada" class="list-group-item list-group-item-action"
              (click)="selecionarSugestao(sugestao, 'localRetirada')">
            {{ sugestao }}
          </li>
        </ul>
      </div>

      <!-- EndereÃ§o de Destino -->
      <div class="mb-3">
        <label class="form-label fw-bold">ğŸ¯ EndereÃ§o de Destino</label>
        <input type="text" id="localDestino" class="form-control" formControlName="localDestino" placeholder="Digite o destino" />
        <ul *ngIf="sugestoesDestino.length > 0" class="list-group mt-2">
          <li *ngFor="let sugestao of sugestoesDestino" class="list-group-item list-group-item-action"
              (click)="selecionarSugestao(sugestao, 'localDestino')">
            {{ sugestao }}
          </li>
        </ul>
      </div>

      <!-- BotÃ£o de CÃ¡lculo -->
      <div class="text-center">
        <button type="button" class="btn btn-primary px-4" (click)="calcularValor()" [disabled]="solicitacaoEmAndamento">
          ğŸ” Calcular Valor
        </button>
      </div>
    </fieldset>
  </form>

  <!-- ğŸ”¥ Exibir apenas se o cÃ¡lculo for bem-sucedido -->
  <form *ngIf="valorEstimado !== null && !solicitacaoConfirmada" [formGroup]="formPlaca" class="card shadow-sm p-4 mt-4 text-center">
    <h4 class="fw-bold">ğŸ’° Valor Estimado:
      <span class="badge bg-success">R$ {{ valorEstimado?.toFixed(2) }}</span>
    </h4>

    <div class="alert alert-warning mt-4 text-start" role="alert">
      âš ï¸ <strong>ObservaÃ§Ã£o:</strong> o valor calculado Ã© uma estimativa baseada na distÃ¢ncia entre os endereÃ§os informados.
      Custos adicionais, como pedÃ¡gios, tempo de espera ou deslocamentos fora de rota, <strong>nÃ£o estÃ£o incluÃ­dos</strong>.
    </div>

    <!-- Campo de Placa -->
    <div class="mb-3 row justify-content-center">
      <div class="col-md-4 text-start">
        <label class="form-label fw-bold">ğŸ”¢ Placa do VeÃ­culo</label>
        <input type="text" class="form-control text-uppercase" formControlName="placa" mask="AAA-0A00" placeholder="Ex: ABC-1D23" />
        <div *ngIf="formPlaca.get('placa')?.touched && formPlaca.get('placa')?.invalid" class="text-danger mt-1">
          Placa Ã© obrigatÃ³ria para contratar o reboque.
        </div>
      </div>
    </div>

    <!-- BotÃ£o Contratar -->
    <div class="d-flex justify-content-center">
      <button class="btn btn-success mt-3 px-4"
              (click)="contratarReboque()"
              [disabled]="solicitacaoEmAndamento || formPlaca.invalid">
        ğŸš› Contratar Reboque
      </button>
    </div>
  </form>

  <!-- ğŸ”¥ Exibir apenas se a solicitaÃ§Ã£o for confirmada -->
  <div *ngIf="solicitacaoConfirmada" class="alert alert-success mt-4 text-center shadow-sm p-4">
    <h4>âœ… SolicitaÃ§Ã£o registrada com sucesso!</h4>
    <h3>ğŸ’° Valor Estimado: <span class="badge bg-success">R$ {{ valorEstimado?.toFixed(2) }}</span></h3>
    <p class="text-muted">Um atendente entrarÃ¡ em contato em breve.</p>

    <p class="text-muted">
      <small>ğŸš¨ Caso queira agilizar o atendimento, clique no botÃ£o abaixo e fale com um atendente pelo WhatsApp.</small>
    </p>

    <button class="btn btn-success mt-2 px-4" (click)="enviarWhatsApp()">
      ğŸ“² Solicitar por WhatsApp
    </button>
  </div>
</div>
